<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Set New Password - stock risk</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'stock-green': '#ff6d00',
            'stock-light': '#2ecc71',
            'stock-red': '#e74c3c',
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          },
        },
      },
    };
  </script>

  <style>
    .bg-energy-pattern {
      background-image:
        linear-gradient(rgba(0, 0, 0, 0.65), rgba(0, 0, 0, 0.75)),
        url('/static/stock/fbg.jpg');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
    }
    .input-focus:focus {
      outline: none;
      border-color: #27ae60;
      box-shadow: 0 0 0 3px rgba(46, 204, 113, 0.3);
    }
    .strength-meter {
      height: 4px;
      border-radius: 2px;
      transition: all 0.3s;
      margin-top: 6px;
    }
    .strength-weak { background-color: #e74c3c; width: 33%; }
    .strength-medium { background-color: #f39c12; width: 66%; }
    .strength-strong { background-color: #27ae60; width: 100%; }
    .password-match { color: #27ae60; }
    .password-mismatch { color: #e74c3c; }
  </style>
</head>

<body class="bg-energy-pattern min-h-screen flex items-center justify-center p-4">

  <div class="w-full max-w-md">
    <!-- Card -->
    <div class="bg-white/95 backdrop-blur-lg rounded-2xl shadow-2xl p-8 border border-gray-100">

      <!-- Header -->
      <div class="text-center mb-8">
        <div class="w-20 h-20 mx-auto mb-4 bg-stock-green rounded-full flex items-center justify-center text-white text-3xl shadow-lg">
          <i class="fas fa-key"></i>
        </div>
        <h2 class="text-2xl font-bold text-gray-800">Set New Password</h2>
        <p class="text-gray-600 mt-2 text-sm">
          Create a strong password for <span class="font-medium text-stock-green">{{ email }}</span>
        </p>
      </div>

      <!-- Form -->
      <form action="/myapp/changePassword/" method="post" id="passwordForm">
        {% csrf_token %}
        <input type="hidden" name="email" value="{{ email }}">

        <!-- New Password -->
        <div class="mb-5">
          <label for="newPassword" class="block text-sm font-medium text-gray-700 mb-2">
            New Password
          </label>
          <div class="relative">
            <input
              type="password"
              name="newPassword"
              id="newPassword"
              placeholder="Enter new password"
              class="w-full pr-12 pl-4 py-3 rounded-lg border border-gray-300 bg-white text-gray-800 placeholder-gray-400 input-focus transition"
              required
            />
            <button
              type="button"
              class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-stock-green"
              id="toggleNew"
            >
              <i class="fas fa-eye"></i>
            </button>
          </div>
          <div class="strength-meter mt-2" id="strengthMeter"></div>
          <p class="text-xs text-gray-500 mt-1" id="strengthText">Use 8+ characters with letters, numbers & symbols</p>
        </div>

        <!-- Confirm Password -->
        <div class="mb-6">
          <label for="confirmPassword" class="block text-sm font-medium text-gray-700 mb-2">
            Confirm Password
          </label>
          <div class="relative">
            <input
              type="password"
              name="confirmPassword"
              id="confirmPassword"
              placeholder="Re-enter password"
              class="w-full pr-12 pl-4 py-3 rounded-lg border border-gray-300 bg-white text-gray-800 placeholder-gray-400 input-focus transition"
              required
            />
            <button
              type="button"
              class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-stock-green"
              id="toggleConfirm"
            >
              <i class="fas fa-eye"></i>
            </button>
          </div>
          <p class="text-xs mt-1 hidden" id="matchText">
            <i class="fas fa-check-circle password-match"></i> Passwords match
          </p>
          <p class="text-xs mt-1 hidden text-stock-red" id="mismatchText">
            <i class="fas fa-times-circle"></i> Passwords do not match
          </p>
        </div>

        <!-- Submit Button -->
        <button
          type="submit"
          class="w-full py-3.5 bg-stock-green text-white font-bold rounded-lg hover:bg-stock-light transition shadow-md hover:shadow-lg transform hover:-translate-y-0.5 flex items-center justify-center gap-2"
          id="submitBtn"
          disabled
        >
          <i class="fas fa-lock"></i>
          Change Password
        </button>
      </form>




      <!-- Message Alert -->
      {% block body %}
        {% include 'msgalert.html' %}
      {% endblock %}
    </div>

    <!-- Footer -->
    <p class="text-center text-white/80 mt-8 text-xs">
      Â© <span id="year"></span> stock risk analysis. Secure & Powered by RISKLY.
    </p>
  </div>

  <!-- Scripts -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const newPass = document.getElementById('newPassword');
      const confirmPass = document.getElementById('confirmPassword');
      const toggleNew = document.getElementById('toggleNew');
      const toggleConfirm = document.getElementById('toggleConfirm');
      const strengthMeter = document.getElementById('strengthMeter');
      const strengthText = document.getElementById('strengthText');
      const matchText = document.getElementById('matchText');
      const mismatchText = document.getElementById('mismatchText');
      const submitBtn = document.getElementById('submitBtn');
      const form = document.getElementById('passwordForm');

      // Toggle Password Visibility
      toggleNew.addEventListener('click', () => {
        const type = newPass.type === 'password' ? 'text' : 'password';
        newPass.type = type;
        toggleNew.innerHTML = type === 'text' ? '<i class="fas fa-eye-slash"></i>' : '<i class="fas fa-eye"></i>';
      });

      toggleConfirm.addEventListener('click', () => {
        const type = confirmPass.type === 'password' ? 'text' : 'password';
        confirmPass.type = type;
        toggleConfirm.innerHTML = type === 'text' ? '<i class="fas fa-eye-slash"></i>' : '<i class="fas fa-eye"></i>';
      });

      // Password Strength
      function checkStrength(password) {
        let strength = 0;
        if (password.length >= 8) strength++;
        if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
        if (/[0-9]/.test(password)) strength++;
        if (/[^a-zA-Z0-9]/.test(password)) strength++;

        strengthMeter.className = 'strength-meter mt-2';
        strengthText.className = 'text-xs mt-1';

        if (strength <= 1) {
          strengthMeter.classList.add('strength-weak');
          strengthText.textContent = 'Weak password';
          strengthText.className += ' text-stock-red';
        } else if (strength <= 2) {
          strengthMeter.classList.add('strength-medium');
          strengthText.textContent = 'Medium strength';
          strengthText.className += ' text-orange-600';
        } else {
          strengthMeter.classList.add('strength-strong');
          strengthText.textContent = 'Strong password!';
          strengthText.className += ' text-stock-green';
        }
      }

      // Confirm Password Match
      function checkMatch() {
        const match = newPass.value && confirmPass.value && newPass.value === confirmPass.value;
        matchText.classList.toggle('hidden', !match);
        mismatchText.classList.toggle('hidden', match);
        submitBtn.disabled = !match || newPass.value.length < 8;
      }

      // Event Listeners
      newPass.addEventListener('input', () => {
        checkStrength(newPass.value);
        checkMatch();
      });

      confirmPass.addEventListener('input', checkMatch);

      // Year
      document.getElementById('year').textContent = new Date().getFullYear();

      // Auto-focus
      newPass.focus();
    });
  </script>
</body>
</html>